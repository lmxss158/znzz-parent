<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>${AppName!}后台系统</title>
    <link rel="shortcut icon" href="${base!}/favicon.ico" type="image/x-icon"/>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="${base!}/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/Ionicons/css/ionicons.min.css">

    <link rel="stylesheet" href="${base!}/assets/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <!-- <link rel="stylesheet" href="${base!}/assets/dist/css/AdminLTE.css"> -->
    <link rel="stylesheet" href="${base!}/assets/dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="${base!}/assets/dist/css/AdminLTE.min.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/datepicker/bootstrap-datepicker3.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/iCheck/all.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/select2/select2.min.css">
    <link rel="stylesheet" href="${base!}/assets/dist/css/bootstrapValidator.css">
    <link rel="stylesheet" href="${base!}/assets/dist/css/AdminLTE1.css">
    <!-- <link rel="stylesheet" href="${base!}/assets/dist/css/skins/_all-skins.min.css"> -->
    <link rel="stylesheet" href="${base!}/assets/plugins/toastr/toastr.min.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/treetable/jquery.treetable.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/bootstrap-daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/gateway/gateway-management.css">
    <!--
    <link rel="stylesheet" href="${base!}/assets/plugins/gateway/gateway-management.css"> -->
    <link rel="stylesheet" href="${base!}/assets/webuploader/webuploader.css">
    <link rel="stylesheet" href="${base!}/assets/css/switchery.css">
    <link rel="stylesheet" href="${base!}/assets/css/nestable.css">
    <link rel="stylesheet" href="${base!}/assets/css/stepy.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/jstree/themes/default/style.min.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/ztree/zTreeStyle.css">
    <link rel="stylesheet" href="${base!}/assets/css/themify-icons.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/stepy/jquery.stepy.css">
    <link rel="stylesheet" href="${base!}/assets/css/selfCss/asset.css">
    <link rel="stylesheet" href="${base!}/assets/css/selfCss/bootstrap-grid.min.css">
    <link rel="stylesheet" href="${base!}/assets/css/selfCss/style.css">

    <link rel="stylesheet" href="${base!}/assets/plugins/selectpage/selectpage.css">
    <link rel="stylesheet" href="${base!}/assets/plugins/selectpage/selectpage.bootstrap3.css">
    <link rel="stylesheet" href="${base!}/assets/dist/css/index.css">
    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.4.2/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
     -->
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="${base!}/assets/plugins/jquery-1.11.1.min.js"></script>
    <!-- <script src="${base!}/assets/plugins/jQuery/jquery.min.js"></script> -->
    <script type="text/javascript">
        var base = '${base!}';
    </script>

    <style type="text/css">
        /* .repairCycle{width: 18px;height: 18px;background: orange;border-radius:50px;position: absolute ; left: 86px ; bottom: 7px}
        .cycleFont{position: absolute; left: 4px;bottom: -1px;color: white;} */

    </style>


</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
 <!--   <div class="modal fade" id="loading-modal" data-backdrop="static" data-keyboard="false">
        <div class="loadEffect">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>-->
    <header class="main-header">
        <a class="logo">
            <span class="logo-mini"><b>${AppShrotName!}</b></span>
            <span class="logo-lg"><b>${AppName!}</b></span>
        </a>
        <nav class="navbar navbar-static-top">
            <div class="col-sm-2">
                <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button"> <span class="sr-only">Toggle navigation</span>
                </a>
                <%
                var unit=@shiro.getPrincipalProperty('unit');
                var nickName=@shiro.getPrincipalProperty('nickName');
                var username=@shiro.getPrincipalProperty('username') ;
                %>
            </div>

            <div id="fastIntoMenu" class="col-sm-7 head-href">
                <div >
                    <a href="${base}/platform/account/indexNew">首页</a>
                </div>
                <%
                     var fastIntoMenus= @shiro.getPrincipalProperty('userFastIntoMenu');
                     for(fastIntoMenu in fastIntoMenus){
                %>

                <div id="a__${fastIntoMenu.permission}">
                    <% if(!isEmpty(fastIntoMenu)){ %>
                        <a  data-pjax="" href="${base}${fastIntoMenu.href}">${fastIntoMenu.name}</a>
                    <%}%>
                </div>
                <%}%>


            </div>

            <div class="col-sm -3 navbar-custom-menu">

                <ul class="nav navbar-nav">
                    <!--铃铛提示信息-->
                    <!--<li class="dropdown notifications-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-bell-o"></i>
                            <span class="label label-warning">10</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="header"> 你有十条信息</li>
                            <li>
                                <ul class="menu">
                                    <li>
                                        <a href="#">
                                            <i class="fa fa-users text-aqua"></i> 五个新成员加入
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <i class="fa fa-warning text-yellow"></i> 111
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <i class="fa fa-users text-red"></i> 222
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <i class="fa fa-shopping-cart text-green"></i> 333
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <i class="fa fa-user text-red"></i> 44444
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li class="footer"><a href="#">查看所有</a></li>
                        </ul>
                    </li>
-->
                    <li class="dropdown user user-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <span class="hidden-xs">${unit.name}&nbsp;&nbsp; </span>
                    <li class="dropdown user user-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown"> <img
                            src="${base!}/assets/dist/img/user2-160x160.jpg" class="user-image" alt="User Image"> <span
                            class="hidden-xs">${(@nickName==""||@nickName==null)?username:nickName}</span></a>

                        <ul class="dropdown-menu">
                            <!-- User image -->

                            <li class="user-header"><img src="${base!}/assets/dist/img/user2-160x160.jpg"
                                                         class="img-circle" alt="User Image">
                                <p>
                                    ${@shiro.getPrincipalProperty('unitid')}
                                    <small>${@shiro.getPrincipalProperty('email')}</small>
                                </p>
                            </li>
                            <li class="user-footer">
                                <div class="pull-left">
                                    <!-- <a href="${base!}/platform/sys/user/pass" id="left" class="btn btn-default btn-flat">${msg['index.user.password']}</a> -->
                                    <a href="javascript:openModule('${base!}/platform/sys/user/pass')"
                                       data-target="#myModal2" class="btn btn-default btn-flat">${msg['index.user.password']}</a>
                                </div>
                                <!-- <div class="pull-left" style="padding-left: 6px">
                                <button type="button" class="btn btn-default btn-flat" data-toggle="modal" data-target="#myModal">切换主题</button>
                                </div> -->
                                <div class="pull-right">
                                    <a id="logout" href="${base!}/platform/login/logout" class="btn btn-default btn-flat">退出系统</a>
                                </div>
                            </li>
                        </ul>

                    </li>
                </ul>
            </div>


        </nav>
    </header>

    <aside class="main-sidebar">
        <section class="sidebar">
            <div class="user-panel">
                <div class="pull-left image">
                    <img src="${base!}/assets/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                </div>
                <div class="pull-left info">
                    <p>${(@nickName==""||@nickName==null)?username:nickName}</p>
                    <a href="#"><i class="fa fa-circle text-success"></i>在线</a>
                </div>
            </div>

            <ul class="sidebar-menu" data-widget="tree">
                <li class="header ">主导航</li>
               <!-- <li class="active"><a href="${base!}/platform/home"><i class="ti-home"></i><span>首页</span></a></li>-->
                <%
                var secondMenus=@shiro.getPrincipalProperty('secondMenus');
                for(firstMenu in @shiro.getPrincipalProperty('firstMenus')){
                %>
                <% if(!isEmpty(@secondMenus.get(firstMenu.path))){%>
                <li class="treeview">
                    <a id="${firstMenu.permission}" href="#">
                        <% if(!isEmpty(firstMenu.icon)){ %>
                        <i class=${firstMenu.icon} style="width:25px;"></i>
                        <%}else{%>
                        <i class="ti-heart" style="width:25px;"></i>
                        <% } %>
                        <span>${firstMenu.name}</span>
                        <span class="pull-right-container">
									<i class="fa fa-angle-left pull-right"></i>
								</span>
                    </a>
                    <%}else{%>
                <li>
                    <a id="${firstMenu.permission}"
                       href="<% if(!isEmpty(firstMenu.href)){ %><%if(@string.startWith(firstMenu.href,'/')){%>${base}${firstMenu.href!}<%}else{%>${firstMenu.href!}<%}%> <% }else{ %>javascript:;<% } %>"
                    <%if(@string.startWith(firstMenu.target,'_')){%>target="${firstMenu.target!}"<%}else{%>${firstMenu.target!}<%}%>>
                    <% if(!isEmpty(firstMenu.icon)){ %>
                    <i class=${firstMenu.icon} style="width:25px;"></i>
                    <%}else{%>
                    <i class="ti-heart" style="width:25px;"></i>
                    <% } %>
                    <span>${firstMenu.name}</span>
                    </a>
                    <%}%>
                    <% if(!isEmpty(@secondMenus.get(firstMenu.path))){%>
                    <ul class="treeview-menu">
                        <% for(secondMenu in @secondMenus.get(firstMenu.path)){ %>
                        <% if(!isEmpty(@secondMenus.get(secondMenu.path))){ %>
                        <li class="treeview">
                            <a href="<% if(!isEmpty(secondMenu.href)){ %><%if(@string.startWith(secondMenu.href,'/')){%>${base}${secondMenu.href!}<%}else{%>${secondMenu.href!}<%}%> <% }else{ %>javascript:;<% } %>"
                            <%if(@string.startWith(secondMenu.target,'_')){%>target="${secondMenu.target!}"<%}else{%>${secondMenu.target!}<%}%>>
                            <% if(!isEmpty(secondMenu.icon)){ %>
                            <i class=${secondMenu.icon} style="width:25px;"></i>
                            <%}else{%>
                            <i class="ti-heart" style="width:25px;"></i>
                            <% } %>
                            <span id="${secondMenu.permission}">${secondMenu.name}


												</span>
                            <span class="pull-right-container">
													<i class="fa fa-angle-left pull-right"></i>
												</span>
                            </a>
                            <%}else{%>
                        <li>
                            <a href="<% if(!isEmpty(secondMenu.href)){ %><%if(@string.startWith(secondMenu.href,'/')){%>${base}${secondMenu.href!}<%}else{%>${secondMenu.href!}<%}%> <% }else{ %>javascript:;<% } %>"
                            <%if(@string.startWith(secondMenu.target,'_')){%>target="${secondMenu.target!}"<%}else{%>${secondMenu.target!}<%}%>>
                            <% if(!isEmpty(secondMenu.icon)){ %>
                            <i class=${secondMenu.icon} style="width:25px;"></i>
                            <%}else{%>
                            <i class="ti-heart" style="width:25px;"></i>
                            <% } %>
                            <span id="${secondMenu.permission}">${secondMenu.name}</span>
                            </a>
                            <%}%>
                            <% if(!isEmpty(@secondMenus.get(secondMenu.path))){ %>
                            <ul class="treeview-menu">
                                <% for(thMenu in @secondMenus.get(secondMenu.path)){ %>
                                <% if(!isEmpty(@secondMenus.get(thMenu.path))){ %>
                                <li class="treeview">
                                    <a <% if(!isEmpty(thMenu.href)){
                                    %>href="<%if(@string.startWith(thMenu.href,'/')){%>${base}${thMenu.href!}<%}else{%>${thMenu.href!}<%}%>"
                                    <% }else{ %>href="javascript:;"<% } %>
                                    <%if(@string.startWith(thMenu.target,'_')){%>target="${thMenu.target!}"<%}else{%>${thMenu.target!}<%}%>>
                                    <% if(!isEmpty(thMenu.icon)){ %>
                                    <i class=${thMenu.icon} style="width:25px;"></i>
                                    <%}else{%>
                                    <i class="ti-heart" style="width:25px;"></i>
                                    <% } %>
                                    <span id="${thMenu.permission}">${thMenu.name}</span>
                                    <span class="pull-right-container">
																<i class="fa fa-angle-left pull-right"></i>
												</span>
                                    </a>

                                    <%}else{%>
                                <li>
                                    <a <% if(!isEmpty(thMenu.href)){
                                    %>href="<%if(@string.startWith(thMenu.href,'/')){%>${base}${thMenu.href!}<%}else{%>${thMenu.href!}<%}%>"
                                    <% }else{ %>href="javascript:;"<% } %>
                                    <%if(@string.startWith(thMenu.target,'_')){%>target="${thMenu.target!}"<%}else{%>${thMenu.target!}<%}%>>
                                    <span>${thMenu.name}</span>
                                    <span class="pull-right-container">
																<small class="label pull-right bg-yellow"></small>
															</span>
                                    </a>
                                    <%}%>
                                    <% if(!isEmpty(@secondMenus.get(thMenu.path))){ %>

                                    <ul class="treeview-menu">
                                        <% for(fuMenu in @secondMenus.get(thMenu.path)){ %>

                                        <li>
                                            <a <% if(!isEmpty(fuMenu.href)){
                                            %>href="<%if(@string.startWith(fuMenu.href,'/')){%>${base}${fuMenu.href!}<%}else{%>${fuMenu.href!}<%}%>"
                                            <% }else{ %>href="javascript:;"<% } %>
                                            <%if(@string.startWith(fuMenu.target,'_')){%>target="${fuMenu.target!}"<%}else{%>${fuMenu.target!}<%}%>>
                                            <span id="${fuMenu.permission}">${fuMenu.name}</span>
                                            <span class="pull-right-container">
																<small class="label pull-right bg-yellow"></small>
															</span>
                                            </a>
                                        </li>
                                        <% }%>
                                    </ul>
                                    <%}%>

                                    <% }%>
                            </ul>
                            <%}%>
                        </li>
                        <%}%>
                    </ul>
                    <%}%>
                </li>
                <%}%>
            </ul>
        </section>
    </aside>

    <div class="content-wrapper" id="container">
        ${layoutContent}
    </div>
    <!-- <div id="dictmap" >
    </div> -->
    <div class="control-sidebar-bg"></div>
    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>${AppName!}</b>
            <a href="${base}/platform/sys/user/userManual">用户使用说明书</a>
        </div>
        <strong>Copyright &copy; 2017 - ${date(),dateFormat = 'yyyy'} <a href="http://www.htfudao.com.cn/" target="_blank">航天福道</a></strong>
    </footer>
</div>
<script src="${base!}/assets/plugins/jstree/jstree.min.js"></script>
<script src="${base!}/assets/plugins/ztree/jquery.ztree.core.min.js"></script>
<script src="${base!}/assets/plugins/ztree/jquery.ztree.excheck.min.js"></script>
<script src="${base!}/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="${base!}/assets/plugins/fastclick/fastclick.js"></script>
<!--<script src="${base!}/assets/dist/js/app.min.js"></script>-->
<script src="${base!}/assets/plugins/sparkline/jquery.sparkline.min.js"></script>
<script src="${base!}/assets/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="${base!}/assets/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<script src="${base!}/assets/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- 	<script src="${base!}/assets/plugins/chartjs/Chart.min.js"></script> -->
<script src="${base!}/assets/dist/js/echarts.min.js"></script>


<!-- <script src="${base!}/assets/dist/js/pages/dashboard2.js"></script> -->
<script src="${base!}/assets/dist/js/warning.js"></script>
<script src="${base!}/assets/js/form.js"></script>
<script src="${base!}/assets/js/jquery.pjax.js"></script>
<script src="${base!}/assets/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="${base!}/assets/plugins/datatables/dataTables.bootstrap.min.js"></script>

<script src="${base!}/assets/plugins/iCheck/icheck.min.js"></script>
<script src="${base!}/assets/plugins/select2/select2.full.min.js"></script>
<script src="${base!}/assets/dist/js/bootstrapValidator.js"></script>
<!-- <script src="${base!}/assets/dist/js/app.min.js"></script> -->
<!-- <script src="${base!}/assets/dist/js/demo.js"></script> -->
<script src="${base!}/assets/plugins/toastr/toastr.min.js"></script>
<script src="${base!}/assets/js/toast.js"></script>
<script src="${base!}/assets/js/main.js"></script>
<script src="${base!}/assets/plugins/treetable/jquery.treetable.js"></script>
<script src="${base!}/assets/js/page.js"></script>
<script src="${base!}/assets/plugins/switchery/switchery.js"></script>
<script src="${base!}/assets/plugins/jquery.form.js"></script>
<script src="${base!}/assets/plugins/moment/min/moment.min.js"></script>
<script src="${base!}/assets/plugins/datepicker/bootstrap-datepicker.js"></script>
<script src="${base!}/assets/plugins/bootstrap-datepicker/dist/locales/bootstrap-datepicker.zh-CN.min.js"></script>

<script src="${base!}/assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="${base!}/assets/plugins/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="${base!}/assets/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<script src="${base!}/assets/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
<script src="${base!}/assets/js/date.js"></script>
<script src="${base!}/assets/js/dateUtil.js"></script>
<script src="${base!}/assets/js/customAssets.js"></script>
<script src="${base!}/assets/plugins/stepy/jquery.stepy.js"></script>
<script src="${base!}/assets/plugins/stepy/jquery.validate.min.js"></script>
<script src="${base!}/assets/plugins/jquery.sortable.js"></script>
<script src="${base!}/assets/plugins/jquery.nestable.js"></script>


<script src="${base!}/assets/webuploader/webuploader.min.js"></script>
<script src="${base!}/assets/plugins/jQuery/jquery.ajaxupload.js"></script>
<script src="${base!}/assets/js/zoomify.min.js"></script>
<script src="${base!}/assets/plugins/selectpage/selectpage.js"></script>
<script src="${base!}/assets/dist/js/adminlte.min.js"></script>
<script src="${base!}/assets/plugins/jquery.cookie.js"></script>

<script>
    $(function () {
        $(".head-href > div").each(function (index) {
            $(this).click(function () {

                $(".head-href > div").removeClass('head-nav-home');
                $(".head-href > div").eq(index).addClass("head-nav-home");
                var id = $(".head-href > div").eq(index).attr("id") ;
                var href = $(".head-href > div").eq(index).children("a").attr("href") ;
                clearMenuSelectedStatus() ;//清除菜单所有选中状态
                setMenuSelectedStatus(href);//添加当前菜单选中状态
            })
        })
        setFastIntoMenuStauts() ;
        bindLeftSelectedStatus();

    });


    var NOPERMISSION = "您没有该权限";

    //提示没权限弹窗
    function alertNoPermission() {
        Toast.warning(NOPERMISSION);
    }
    //设置跳转后选中效果
    function setFastIntoMenuStauts(){
        var as = $("#fastIntoMenu div a") ;
        var url =  window.location.href ;

        for(var i=0;i<as.length;i++){
            if(as[i].href==url){
                $(".head-href > div").removeClass('head-nav-home');
                $(as[i]).parent().addClass("head-nav-home");

            }
        }
        setMenuSelectedStatus();
    }
    //设置菜单选中状态
    function setMenuSelectedStatus(h){
        var url;
        if(!h){
            url = window.location.href ;
        }else{
            url = getAbsoluteUrl(h);
        }

        var uls =  $(".treeview-menu") ;
        var pls =  $(".sidebar-menu") ;
        uls.push(pls) ;
        for(var i=0;i<uls.length;i++){
            var lis = $(uls[i]).children("li") ;
            for(var j=0;j<lis.length;j++){
                var a = $(lis[j]).children("a");
                var href = $(a).attr("href") ;
                if(href){
                    href = href.trim();
                }
                href = getAbsoluteUrl(href);

                if(url==href){

                    $(lis[j]).addClass("active");
                    openChildMenu(lis[j]);
                }
            }
        }
    }
    //清除所有选中状态及关闭已打开的菜单
    function clearMenuSelectedStatus(ul){
        if(!ul){
            ul = $(".sidebar-menu");
        }
        var lis = $(ul).children() ;
        for(var i=0;i<lis.length;i++){
            var li = lis[i] ;
            $(li).removeClass("active menu-open") ;
            var ull = $(li).children("ul") ;
            if(ull){
                $(ull).css("display","none") ;
                clearMenuSelectedStatus(ull) ;
            }
        }
    }
    //清除所有状态
    function clearMenuSelectedStatus2(ul){
        if(!ul){
            ul = $(".sidebar-menu");
        }
        var lis = $(ul).children() ;
        for(var i=0;i<lis.length;i++){
            var li = lis[i] ;
            $(li).removeClass("active") ;
            var ull = $(li).children("ul") ;
            if(ull){

                clearMenuSelectedStatus(ull) ;
            }
        }
    }

    //获取绝对url地址
    var getAbsoluteUrl = function(url) {
        var a = document.createElement('a');
        a.href=url;
        return a.href;
    }


    //展开当前li的父级菜单
    function openChildMenu(li){

        var ul = $(li).parent("ul");
        if(ul&&ul.length>0){
            $(ul).css("display","block");
            var pli = $(ul).parent("li") ;
            if(pli&&pli.length>0){
                $(pli).addClass("active menu-open");
                openChildMenu(pli);
            }
        }

    }
    //给左侧导航添加点击效果
    function bindLeftSelectedStatus(ul){
        var as = $(".sidebar-menu a");
        for (var i = 0; i < as.length; i++) {
            $(as[i]).click(function () {
                $(".sidebar-menu li").removeClass("active");
                openChildMenu($(this).parent('li'));
                $(this).parent('li').addClass("active");
                var re = $(this).attr("href");
                if(re&&re.trim()!="#"&&re.trim()!="javascript:;"){//点击了有链接的a标签上

                    getATopParent(re) ;
                }
            })
        }

    }
    //获取超链接的顶级菜单
    function getATopParent(href){
        var uls = $(".sidebar-menu");
        var lis = uls.children() ;
        for(var i=0;i<lis.length;i++){
            var li = lis[i] ;
            var as = $(li).find("a") ;
            for(var j=0;j<as.length;j++){
                var reh = $(as[j]).attr("href");
                if(href == reh){//相等,则拿最顶级
                    var lia = $(li).children("a") ;
                    setFastIntoMenuSelected($(lia).attr("id"));
                }
            }
        }
    }
    //将传入的id选中
    function setFastIntoMenuSelected(divId){
        $(".head-href > div").removeClass('head-nav-home');
        var divs = $("#fastIntoMenu").children("div") ;
        for(var i=0;i<divs.length;i++){
            var div = divs[i] ;
            var divIdt = $(div).attr("id") ;
            if(divIdt){//存在
                var divId2 = divIdt.split("__")[1] ;
                if(divId&&(divId==divId2)){
                    $(div).addClass("head-nav-home") ;
                }
            }
        }

    }

    function loading(loadStatus) {
        if (loadStatus === true) {
            $("#loading-modal").modal('show');
        } else if (loadStatus === false) {
            $("#loading-modal").modal('hide');
        } else {
        }
    }

    //id为页面单位 元素id   pid 为页面会员 元素id ; 可以传空值
    var loadUnitAndUser = function (id, pid, type) {
        if (!id) {
            id = "borrowDepart";
        }
        if (!pid) {
            pid = "chargePerson";
        }
        getUnitList(id, pid);
        getEmployeeList(null, pid, id, type);
    }
    //去除库房
    var loadUnitAndUserNoKuFang = function (id, pid, type) {
        if (!id) {
            id = "borrowDepart";
        }
        if (!pid) {
            pid = "chargePerson";
        }
        getUnitListNoKuFang(id, pid);
        getEmployeeList(null, pid, id, type);
    }

    var userAndUnit = {};//暂存 会员id与单位id的关系
    var userData = {};
    var eArr = new Array();
    var getEmployeeList = function (unitid, pid, id, type) {
        if (type == null) {
            type = 1;
        }
        var arr = new Array();
        $("#" + pid).val("");

        $.ajax({
            type: "post",
            url: "${base}/platform/sys/user/getUserIdAndNameList",
            data: {unitid: unitid, type: type},
            async: false,
            success: function (data) {
                var re = data;
                for (var i = 0; i < re.length; i++) {
                    var infos = {};
                    var info = re[i];
                    var tname = info.username + " / " + info.name;
                    infos["name"] = tname;
                    infos["code"] = info.id;
                    arr.push(infos);
                    userAndUnit[info.id] = info.unitid;
                    userData[info.id] = tname;
                }

            },
            error: function (e) {

            }
        });
        if (arr.length == 0) {
            var ijson = {};
            ijson["name"] = "请选择";
            ijson["code"] = "";
            arr.push(ijson)
        }
        if (!unitid) {
            $("#" + pid).selectPage({
                showField: 'name',
                keyField: 'code',
                pageSize: 5,
                data: arr,
                autoFillResult: false,
                eSelect: function (data) {
                    if (data) {
                        var unitId = userAndUnit[data.code];
                        if (unitId) {
                            $("#" + id).val(unitId);
                            $("#" + id).selectPageRefresh();
                        }
                    }
                },
                eClear: function () {
                    reloadUserAndUnit(id, pid);
                }
            });
            eArr = arr;
        } else {
            $(".sp_clear_btn").remove();
            $('#' + pid).selectPageData(arr);
        }


    }


    var unitData;//单位数据
    //加载单位下拉列表最新
    var getUnitList = function (id, pid) {

        var arr = new Array();
        $('#' + id).val("");//selelctpage 插件渲染时 input框不能有值
        $.ajax({
            type: "post",
            url: "${base}/platform/sys/unit/getUnitJsonList",
            async: false,
            success: function (data) {
                if (data) {//非null

                    for (var i = 0; i < data.length; i++) {
                        var info = data[i];
                        var infos = {};
                        infos["name"] = info.name;
                        infos["code"] = info.id;
                        arr.push(infos);
                    }

                }
            },
            error: function (data) {

            }
        });
        if (arr.length == 0) {
            var ijson = {};
            ijson["name"] = "请选择";
            ijson["code"] = "";
            arr.push(ijson)
        }

        $("#" + id).selectPage({
            showField: 'name',
            keyField: 'code',
            pageSize: 5,
            data: arr,
            orderBy:['code'],
            autoFillResult: false,
            eSelect: function (data) {
                if (data) {
                    getEmployeeList(data.code, pid);
                }
            },
            eClear: function () {
                reloadUserAndUnit(id, pid);
            }
        });

        unitData = arr;

    }

    //去除库房
    var getUnitListNoKuFang = function (id, pid) {

        var arr = new Array();
        $('#' + id).val("");//selelctpage 插件渲染时 input框不能有值
        $.ajax({
            type: "post",
            url: "${base}/platform/sys/unit/getUnitJsonList",
            async: false,
            success: function (data) {
                if (data) {//非null

                    for (var i = 0; i < data.length; i++) {
                        var info = data[i];
                        var infos = {};
                        if (info.name == '库房') {
                            continue;
                        }

                        infos["name"] = info.name;
                        infos["code"] = info.id;
                        arr.push(infos);
                    }

                }
            },
            error: function (data) {

            }
        });
        if (arr.length == 0) {
            var ijson = {};
            ijson["name"] = "请选择";
            ijson["code"] = "";
            arr.push(ijson)
        }

        $("#" + id).selectPage({
            showField: 'name',
            keyField: 'code',
            pageSize: 5,
            data: arr,
            orderBy:['code'],
            autoFillResult: false,
            eSelect: function (data) {
                if (data) {
                    getEmployeeList(data.code, pid);
                }
            },
            eClear: function () {
                reloadUserAndUnit(id, pid);
            }
        });

        unitData = arr;

    }

    var reloadUserAndUnit = function (id, pid) {
        $(".sp_clear_btn").remove();
        $('#' + id).selectPageData(unitData);
        $('#' + pid).selectPageData(eArr);
    }

    //赋值绑定事件 , value 为用户id, value2为单位id
    var setValueSelect = function (value, value2, id, pid) {

        if (!id) {
            id = "borrowDepart";
        }
        if (!pid) {
            pid = "chargePerson";
        }
        if (value) {
            if (checkUserExist(value)) {
                $("#" + pid).val(value);
                $("#" + pid).selectPageRefresh();
            }

        }

        if (value2) {
            if (checkUnitExist(value2)) {
                $("#" + id).val(value2);
                $("#" + id).selectPageRefresh();
            }
        }

    }

    //校验单位是否存在
    var checkUnitExist = function (unitId) {
        var flag = false;
        for (var i = 0; i < unitData.length; i++) {
            var unit = unitData[i];
            var code = unit.code;
            if (code == unitId) {
                flag = true;
                break;
            }
        }

        return flag;

    }
    //校验用户是否存在
    var checkUserExist = function (userId) {
        var flag = false;
        var v = userData[userId];
        if (v) {
            flag = true;
        }
        return flag;
    }
</script>
<script type="text/javascript">
    $(document).ready(function () {
        if ($.support.pjax) {
            $(document).pjax('a[data-pjax]', '#container', {
                maxCacheLength: 0,
                push: false,
                replace: true,
                fragment: '#container',
                timeout: 8000
            });
        }
    });
</script>
<script>
    $(document).ready(function () {
        function loading(loadStatus) {
            if (loadStatus === true) {
                $("#loading-modal").modal('show');
            } else if (loadStatus === false) {
                $("#loading-modal").modal('hide');
            } else {
            }
        }
    });
    $(function () {
        startRepariTip();
        initDict();
        // 清除浏览逾期的cookie
        $("#logout").on('click', function () {
            $.cookie("open", "", {expires: -1, path: '/'});
        });
    });

    var dictArr;

    function initDict() {
        $.ajax({
            type: "post",
            url: "${base}/platform/sys/dict/initDict",
            dataType: 'JSON',
            success: function (data) {
                dictArr = [];//清空数组dictArr
                //var obj = $.parseJSON(data);
                for (var i in data) {
                    dictArr.push(data[i]);
                }
                //startSelect("test");
            },
            error: function (data) {

            }

        });
    }

    function startSelect(id, val) {	//id是select下拉框id属性值，val是控制 selected回显属性
        if (typeof(dictArr) == 'undefined') {
            //dictArr数组里是否存在数据,解决页面重新加载造成的全局变量dictArr数据消失
            initDict();
        }

        if (!id) {
            return;
        }
        setTimeout(function () {
            var str = "";
            for (var i = 0; i < dictArr.length; i++) {
                if (dictArr[i].code == id) {
                    var dictid = dictArr[i].id;
                    for (var j = 0; j < dictArr.length; j++) {
                        if (dictArr[j].parentId == dictid) {
                            if (!val) {
                                str += "<option value='" + dictArr[j].code + "'>" + dictArr[j].name + "</option>"
                            } else {
                                if (dictArr[j].code == val) {
                                    str += "<option value='" + dictArr[j].code + "' selected>" + dictArr[j].name + "</option>"
                                } else {
                                    str += "<option value='" + dictArr[j].code + "'>" + dictArr[j].name + "</option>"
                                }
                            }

                        }

                    }
                }

            }
            $("#" + id).html(str);
        }, 200);

    }

    /* //列表显示数据字典里的值
     var dictVal;
    function getVal(id,val){
        for(var i=0;i<dictArr.length;i++){
            if(dictArr[i].code == id){
                var dictid = dictArr[i].id;
                for(var j=0;j<dictArr.length;j++){
                    if(dictArr[j].parentId == dictid){
                        if(val==dictArr[j].code){
                            dictVal = dictArr[j].name;
                        }

                    }

                }
            }

        }
    }
    function listDict(id,val){

        getVal(id,val);

        if(!dictVal){
            return '';
        }else{
            return "<span class='label bg-green'>"+dictVal+"</span>";
        }

        return '';
} */

    //有处理中菜单时才会启动定时
    function startRepariTip() {
        var processObj = $("span[id*='repair.manager.processing']");
        var approveObj = $("span[id*='asset.unit.approve']"); //资产管理(科室) 审批
        countTip();//初始加载展示
        if (processObj.length > 0 || approveObj.length > 0) {
            setInterval('countTip()', 30000);
        }

    }

    var fontStyle = "<font color='orange'>(#@$)</font>";

    //统计维修相关提醒
    function countTip() {

        $.ajax({
            type: "post",
            url: "${base}/repair/getCount",
            success: function (data) {
                //设备
                var str = "  ";
                var dnum = 0;
                var ynum = 0;
                var obj = $("span[id='repair.manager.approve']");
                var bf = $(obj).children("font") ;

                if (data.s0) {
                    str =str+ fontStyle.replace("#@$", data.s0);
                    var fhtml = $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {//拥有该菜单
                        dnum += data.s0;
                    }
                }else{
                    if(bf){
                        $(bf).remove() ;
                    }
                }
                //$(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.repairwait']");
                bf = $(obj).children("font") ;
                if (data.s1) {
                    str =str+  fontStyle.replace("#@$", data.s1);
                    var fhtml = $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {
                        dnum += data.s1;
                    }
                }else{
                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);

                str = "  ";
                obj = $("span[id='repair.manager.repairing']");
                bf = $(obj).children("font") ;
                if (data.s2) {
                    str =str+  fontStyle.replace("#@$", data.s2);
                    var fhtml = $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {
                        dnum += data.s2;
                    }
                }else{
                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.check']");
                bf = $(obj).children("font") ;
                if (data.s3) {
                    str = str+ fontStyle.replace("#@$", data.s3);
                    var fhtml = $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {
                        dnum += data.s3;
                    }
                }else{
                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.device']");
                bf = $(obj).children("font") ;
                if (dnum != 0) {
                    str = str+fontStyle.replace("#@$", dnum);
                    var fhtml = $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                }else{
                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);


                //仪器
                str = "  ";
                obj = $("span[id*='repair.manager.approve2']");
                bf = $(obj).children("font") ;

                if (data.y0) {
                    str = str+ fontStyle.replace("#@$", data.y0);
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新

                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {
                        ynum += data.y0;
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }
                //$(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.repairwait2']");
                bf = $(obj).children("font") ;
                if (data.y1) {
                    str =str+  fontStyle.replace("#@$", data.y1);
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新

                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {
                        ynum += data.y1;
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.repairing2']");
                bf = $(obj).children("font") ;
                if (data.y2) {
                    str =str+ fontStyle.replace("#@$", data.y2);
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {
                        ynum += data.y2;
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }
                //$(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.metering']");
                bf = $(obj).children("font") ;
                if (data.y4) {
                    str =str+ fontStyle.replace("#@$", data.y4);
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {
                        ynum += data.y4;
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.receive']");
                bf = $(obj).children("font") ;
                if (data.y5) {
                    str =str+ fontStyle.replace("#@$", data.y5);
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                    if (obj.length > 0) {
                        ynum += data.y5;
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.asset']");
                bf = $(obj).children("font") ;
                if (ynum != 0) {
                    str = str+fontStyle.replace("#@$", ynum);
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);

                str = "  ";
                obj = $("span[id*='repair.manager.processing']");
                bf = $(obj).children("font") ;
                if (ynum != 0 || dnum != 0) {
                    str = str+ fontStyle.replace("#@$", (ynum + dnum));
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }
              //  $(obj).html(str);

                str = "  ";
                obj = $("a[id='repair.manager']").children("span")[0];

                bf = $(obj).children("font") ;
                if (ynum != 0 || dnum != 0) {
                    str = str+ fontStyle.replace("#@$", (ynum + dnum));
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }








                //填充资产管理申请 提醒
                str = "  ";
                obj = $("span[id='asset.unit.approve']");
                bf = $(obj).children("font") ;
                if (data.unitRecordApproveCount) {
                    str = str+fontStyle.replace("#@$", data.unitRecordApproveCount);
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }
               // $(obj).html(str);

                //填充资产管理申请 提醒
                str = "  ";
                obj = $("a[id='asset.unit']").children("span")[0];
                bf = $(obj).children("font") ;
                if (data.unitRecordApproveCount) {
                    str = str+fontStyle.replace("#@$", data.unitRecordApproveCount);
                    var fhtml =  $(bf).html() ;
                    if(fhtml){//有值,则更新
                        $(bf).html(str) ;
                    }else{
                        $(obj).append(str);
                    }
                }else{

                    if(bf){
                        $(bf).remove() ;
                    }
                }


            },
            error: function (data) {

            }

        });

    }

    //截取字符串省略展示
    var subStrCustom = function (data, length) {
        var div = data;
        if (data) {
            if (data.length > length) {
                str = data.substr(0, length) + "...";
                div = '<div  style="overflow: hidden;text-overflow: ellipsis;cursor: pointer;" ' +
                    'title="' + data + '">' + str + '</div>';
            }
        } else {
            div = "--";
        }


        return div;
    }
    //不主动截取,根据单元格适配出现省略号
    //如果是datatable中单元格引用,则需要在<table>标签中加样式 table-layout:fixed
    var subStrCustomNew = function (data, length) {
        var div = data;
        if (data.length > length) {
            var str = data;
            div = '<div  style="overflow: hidden;text-overflow: ellipsis;cursor: pointer;white-space:nowrap;" ' +
                'title="' + data + '">' + str + '</div>';
        }

        return div;
    }


/*
    var arrs = new Array();

    //获取项目下拉
    function getProjectInfoList(id) {
        if (!id) {
            id = "#exampleInputproject";
        }

        if (arrs.length == 0) {
            var arr = new Array();
            $.ajax({
                type: "post",
                url: "${base}/instrument/monitor/projectinfo/data",
                async: false,
                success: function (data) {
                    var re = data.data;
                    for (var i = 0; i < re.length; i++) {
                        var infos = {};
                        var info = re[i];
                        infos["name"] = info.name;
                        infos["code"] = info.code;
                        arr.push(infos);

                    }

                    arrs = arr;
                },
                error: function (e) {

                }
            });
        }
        $(id).selectPage({
            showField: 'name',
            keyField: 'code',
            pageSize: 5,
            autoFillResult: false,
            data: arrs
        });
    }

    //给项目赋值
    function setProjectInfo(id, value) {

        if (!id) {
            id = "#exampleInputproject";
        }
        if (value) {
            $("#" + id).val(value);
            var flag = checkProjectCodeExist(value);
            if (flag) {
                $("#" + id).selectPageRefresh();
            }
        }
    }

    //检测项目中是否存在该code
    function checkProjectCodeExist(codeValue) {
        var flag = false;
        for (var i = 0; i < arrs.length; i++) {
            var json = arrs[i];
            var c = json.code;

            if (c == codeValue) {
                flag = true;
                break;
            }
        }
        return flag;
    }
*/

    var arrs2 = new Array();

    //获取项目下拉
    function getJGProjectInfoList(id) {

        if (arrs2.length == 0) {
            var arr = new Array();
            $.ajax({
                type: "post",
                url: "${base}/instrument/monitor/jgprojectinfo/jgData",
                async: false,
                success: function (data) {
                    var re = data.data;
                    for (var i = 0; i < re.length; i++) {
                        var infos = {};
                        var info = re[i];
                        infos["name"] = info.name;
                        infos["code"] = info.code;
                        arr.push(infos);

                    }

                    arrs2 = arr;
                },
                error: function (e) {

                }
            });
        }
        $(id).selectPage({
            showField: 'name',
            keyField: 'code',
            pageSize: 5,
            autoFillResult: false,
            data: arrs2
        });
    }

    //给项目赋值
    function setJGProjectInfo(id, value) {
        console.log(id + " : " + value);
        if (value) {
            $("#" + id).val(value);
            var flag = checkJGProjectCodeExist(value);
            console.log(flag);
            if (flag) {
                $("#" + id).selectPageRefresh();
            }
        }
    }

    //检测项目中是否存在该code
    function checkJGProjectCodeExist(codeValue) {
        var flag = false;
        for (var i = 0; i < arrs2.length; i++) {
            var json = arrs2[i];
            var c = json.code;
            if (c == codeValue) {
                flag = true;
                break;
            }
        }
        return flag;
    }


    //处理键盘事件 禁止后退键（Backspace）密码或单行、多行文本框除外
    function banBackSpace(e) {
        var ev = e || window.event;//获取event对象
        var obj = ev.target || ev.srcElement;//获取事件源
        var t = obj.type || obj.getAttribute('type');//获取事件源类型
        //获取作为判断条件的事件类型
        var vReadOnly = obj.getAttribute('readonly');
        var vEnabled = obj.getAttribute('enabled');
        //处理null值情况
        vReadOnly = (vReadOnly == null) ? false : vReadOnly;
        vEnabled = (vEnabled == null) ? true : vEnabled;
        //当敲Backspace键时，事件源类型为密码或单行、多行文本的，
        //并且readonly属性为true或enabled属性为false的，则退格键失效
        var flag1 = (ev.keyCode == 8 && (t == "password" || t == "text" || t == "textarea")
            && (vReadOnly == true || vEnabled != true)) ? true : false;
        //当敲Backspace键时，事件源类型非密码或单行、多行文本的，则退格键失效
        var flag2 = (ev.keyCode == 8 && t != "password" && t != "text" && t != "textarea") ? true : false;
        //判断
        if (flag2) {
            return false;
        }
        if (flag1) {
            return false;
        }
    }

    //禁止后退键 作用于Firefox、Opera
    document.onkeypress = banBackSpace;
    //禁止后退键  作用于IE、Chrome
    document.onkeydown = banBackSpace;


</script>
</body>
</html>
