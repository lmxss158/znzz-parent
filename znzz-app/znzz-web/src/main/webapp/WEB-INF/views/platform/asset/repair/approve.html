
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">
					<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
				</button>
				<h4 class="modal-title" id="myModalLabel">
					<%if(obj.isshow==0){%> 接收 <%}%> <%if(obj.isshow==1){%> 维修记录 <%}%></h4>
			</div>
			<div class="modal-body">
				<div class="box-body">
					<div class="form-horizontal" id="defaultForm">
						<div class="row">
							<!-- /.col -->
							<div class="facility-form">
								<div class="facility-from-col">
									<div class="col-md-12">
										<div class="form-group">
											<label for="assetCode" class="col-sm-2 control-label">统一编号：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="assetCode"
													value="${obj.assetCode}" disabled="disabled">
											</div>

										</div>
										<div class="form-group">
											<label for="deviceCode" class="col-sm-2 control-label">资产类型：</label>
											<div class="col-sm-3">
												<select class="form-control" id="assetType"
													disabled="disabled">
													<option value=""></option> <%if(obj.assetType==1){ %>
													<option value="1" selected="selected">设备</option> <%}%>
													<%if(obj.assetType==2){%>
													<option value="2" selected="selected">仪器</option> <%}%>
												</select>
											</div>

											<label for="assetName" class="col-sm-2 control-label">资产名称：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="assetName"
													disabled="disabled" value="${obj.assetName}">
											</div>
										</div>

										<div class="form-group">
											<label for="serialNumber" class="col-sm-2 control-label">出厂编号：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="serialNumber"
													disabled="disabled" value="${obj.serialNumber}">
											</div>

											<label for="deviceVersion" class="col-sm-2 control-label">型号规格：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="deviceVersion"
													disabled="disabled" value="${obj.deviceversion}">
											</div>
										</div>

										<div class="form-group">
											<label for="linkMan" class="col-sm-2 control-label">联系人：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="linkMan"
													value="${obj.linkman}" disabled="disabled">
											</div>

											<label for="linkPhone" class="col-sm-2 control-label">联系电话：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="linkPhone"
													value="${obj.linkphone}" disabled="disabled">
											</div>

										</div>
										<div class="form-group">
											<label for="remark" class="col-sm-2 control-label">故障现象：</label>
											<div class="col-sm-3">
												<textarea class="form-control" id="remark"
													disabled="disabled">${obj.remark}</textarea>
											</div>
											<label for="attachment" class="col-sm-2 control-label">附件：</label>
											<div class="col-sm-3">
												<textarea class="form-control" id="attachment"
													disabled="disabled">${obj.ext2}</textarea>
											</div>
										</div>

										<%if(obj.assetType==2){%>
										<div class="form-group">
											<label for="borrowDepart" class="col-sm-2 control-label">送修单位：</label>
											<div class="col-sm-3 ">
												<input type="text" name="sendDepart" id="sendDepart"
													style="width: 100%;" placeholder="请选择"<%if(obj.isshow==1){%>disabled="disabled"<%}%>>
											</div>
											<label class="col-sm-2 control-label">送修人：</label>
											<div class="col-sm-3 ">
												<input type="text" name="sendPerson" id="sendPerson"
													style="width: 100%;" placeholder="请选择"<%if(obj.isshow==1){%>disabled="disabled"<%}%>>
											</div>
										</div>
										<%}%> <%if(obj.isshow==1){%>
										<div class="form-group">
											<label for="repairDepart" class="col-sm-2 control-label">维修单位：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="repairDepart"<%if(obj.reusltType!=3){%>disabled="disabled"
												value="${obj.remarkDepart}" <%}%> >
											</div>
											<label for="repairMan" class="col-sm-2 control-label">维修人：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="repairMan"<%if(obj.reusltType!=3){%>disabled="disabled"
												value="${obj.remarkMan}" <%}%>>
											</div>
										</div>
										<div class="form-group">


											<label for="repairCost" class="col-sm-2 control-label">维修费用：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="repairCost"
													onkeyup="clearNoNum(this)" placeholder="单位:元"<%if(obj.reusltType!=3){%>disabled="disabled"
												value="${obj.repairCost}" <%}%>>
											</div>
										</div>


										<div class="form-group">
											<label for="remark" class="col-sm-2 control-label">维修内容：</label>
											<div class="col-sm-8">
												<textarea class="form-control" id="remark"
													disabled="disabled">${obj.repaircontent}</textarea>
											</div>

										</div>
										<div class="form-group">
											<label for="remark" class="col-sm-2 control-label">维修结论：</label>
											<div class="col-sm-8">
												<textarea class="form-control" id="remark"
													disabled="disabled">${obj.repairremark}</textarea>
											</div>

										</div>
										<%}%> <%if(obj.assetType==2&&obj.isshow==1){%>
										<div class="form-group">
											<label for="measureMan" class="col-sm-2 control-label">计量人：</label>
											<div class="col-sm-3">
												<input type="text" class="form-control" id="measureMan"
													value="${obj.measureMan}" disabled="disabled">
											</div>
										</div>
										<div class="form-group">
											<label for="measureResult" class="col-sm-2 control-label">计量结论：</label>
											<div class="col-sm-8">
												<textarea class="form-control" id="measureResult"
													disabled="disabled">${obj.measureResult}</textarea>
											</div>

											<%}%>

										</div>
									</div>

								</div>
							</div>
						</div>
					</div>

				</div>
				<%if(obj.isshow==0){%>

				<div class="modal-footer" style="text-align: center">
					<button type="button" class="btn btn-primary facilityadd-btn"
						data-dismiss="modal" style="margin-right: 53px;"
						onclick="doRefuse(${obj.id})">驳回</button>
					<button type="button" class="btn btn-primary facilityadd-btn"
						onclick="doApprove(${obj.id})">接收</button>
				</div>
				<%}%>


				<!-- 列表 -->
				<%if(obj.isshow==1){%>
				<div class="row">
					<div class="col-xs-12">
						<div class="box">

							<div class="box-body">

								<table id="repairTable"
									class="table table-bordered table-striped table-hover">
									<thead>
										<tr>
											<th>统一编号</th>
											<th>申办单位</th>
											<th>申办人</th>
											<th>操作单位</th>
											<th>操作人</th>
											<th>流程节点</th>
											<th>操作时间</th>
										</tr>
									</thead>

									<tbody>
										<%for(item in obj.list){%>
										<tr>
											<td>${item.assetcode}</td>
											<td>${item.name}</td>
											<td>${item.username}</td>
											<td>${item.dname}</td>
											<td>${item.uname}</td>
											<td>
												<% var status = item.status ;var pid = item.pid; %>
												<% if(@pid==0) 	  {%>待接收<%}else{%> 
												<% if(@status==1) {%>待维修 <%}%> 
												<% if(@status==2) {%>维修中 <%}%> 
												<% if(@status==3) {%>待验收 <%}%> 
												<% if(@status==4) {%>计量中 <%}%>
												<% if(@status==5) {%>待领取 <%}%>
												<% if(@status==6) {%>无法维修<%}%>
												<% if(@status==7) {%>驳回<%}%> 
												<% if(@status==8) {%>完结<%}%>
												<%}%>
											</td>
											<td>${item.operatortime}</td>
										</tr>
										<%}%>

									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<%}%>

			</div>
		</div>
	</div>
	<script>

	$(function(){
		 <%if(obj.assetType==2){%>
		loadUnitAndUser("sendDepart","sendPerson");
		<%if(obj.isshow==1){%>
			var sendDepart = '${obj.senddepart}';
			var sendPerson = '${obj.sendperson}';
			setValueSelect(sendPerson,sendDepart,"sendDepart","sendPerson");
		<%}%>
		<%}%>
	});

	function doApprove(id){
		var sendDepart="" ;
		var sendPerson="" ;
		 <%if(obj.assetType==2){%>
			sendDepart = $("#sendDepart").val() ; 
			sendPerson = $("#sendPerson").val() ; 
		
			if(!sendDepart||!sendPerson){// 有一个为空
				Toast.warning("送修单位和送修人为必选项");
		   		return  ;
			}
		 <%}%>
		$.ajax({
			type:"post",
			url:"${base}/repair/doApprove",
			data:{id:id,sendDepart:sendDepart,sendPerson:sendPerson},
			success:function(data){
				if (data.code == 0) {
	                Toast.success(data.msg);
	                $("#myModal2").modal('hide');
	            } else {
	                Toast.error(data.msg);
	            }
	                datatable.ajax.reload();
			},
			error:function(data){
				Toast.error("网络异常");
			}
		});
	}

	function doRefuse(id){
		$.ajax({
			type:"post",
			url:"${base}/repair/doRefuse",
			data:{id:id},
			success:function(data){
				if (data.code == 0) {
	                Toast.success(data.msg);
	            } else {
	                Toast.error(data.msg);
	            }
	                datatable.ajax.reload();
			},
			error:function(data){
				Toast.error("网络异常");
			}
		});
	}
	
	
</script>