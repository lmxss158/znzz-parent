<div class="modal-dialog" style="width: 1210px;">
    <div class="modal-content">

        <form class="form-horizontal" id="transferAccountsForm" method="post"
              data-parsley-validate action="${base}/asset/recode/addTransferAccountsRecord">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="transferAccountsModal">资产转账</h4>
            </div>
            <div class="modal-body">
                <div class="box-body">
                    <input type="hidden" id="assetCodeArray" value="${obj.assetCode}"/>
                    <div class="row">
                        <div class="col-md-12" style="width: 1200px; margin-bottom: 10px;">
                            <table id="transferAccounts_table" style="width: 100%"
                                   class="table table-bordered table-hover" >
                                <thead>
                                    <tr>
                                        <th>统一编号</th>
                                        <th>资产名称</th>
                                        <th>出厂编号</th>
                                        <th>资产型号</th>
                                        <th>规格</th>
                                        <th>附件</th>
                                        <th>备注</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                            <div class="form-group">
                            </div>
                        <div class="col-md-6"  style="padding-left: 45px">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="width: 25.3%">原使用单位</label>

                                <div class="col-sm-7">
                                    <input type="text"  id="borrowDepart" class="form-control"
                                            style="width: 100%;" value="${obj.borrowDepart!}" readonly/>
                                    <input type="hidden" name="assetCode" value="${obj.assetCode}" >
                                    <input type="hidden" name="borrowDepart"   value="${obj.borrowDepart}" >
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="width: 25.3%">原使用人</label>

                                <div class="col-sm-7">
                                    <input type="text" name="chargePerson" id="chargePerson" class="form-control"
                                           value="${obj.chargePerson!}" placeholder="请选择" style="width: 100%" readonly/>
                                    <input type="hidden" name="chargePerson"   value="${obj.chargePerson}" >
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" style="padding-left: 45px">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="width: 25.3%">现使用单位</label>

                                <div class="col-sm-7">
                                    <input type="text" name="applyDepart" id="applyDepart" placeholder="请选择" style="width: 100%;">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" >
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="width: 25.3%">现使用人</label>

                                <div class="col-sm-7">
                                    <input type="text" name="applyPerson" id="applyPerson" placeholder="请选择" style="width: 100%;">
                                    <input type="hidden" name="assetType"  id="assetType" value="${obj.assetType}" >
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6" style="padding-left: 45px">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="width: 25.3%">办理单位</label>

                                <div class="col-sm-7">
                                    <input type="text" id="add_original_depart"
                                           name="originalDepart" class="form-control"
                                           data-parsley-required="true" style="width: 100%;"
                                           placeholder="请输入受理单位" value="${obj.unit!}" readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="width: 25.3%">办理人</label>

                                <div class="col-sm-7">
                                    <input type="text" id="add_handle_person"  class="form-control"
                                           data-parsley-required="true" style="width: 100%;"
                                           placeholder="请输入办理人" value="${obj.userName!}" readonly />
                                    <input type="hidden" name="handlePerson" value="${obj.userId}" />
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6" style="padding-left: 45px">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="transferAccountsTime"
                                       style="width: 25.3%">转账日期</label>

                                <div class="col-sm-7">
                                    <div class="input-group date">
                                        <div class="input-group-addon">
                                            <i class="fa fa-calendar"></i>
                                        </div>
                                        <input type="text" class="form-control pull-right"
                                               name="transferAccountsTime" id="transferAccountsTime">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="oprateTime"
                                       style="width: 25.3%">办理日期</label>

                                <div class="col-sm-7">
                                    <div class="input-group date">
                                        <div class="input-group-addon">
                                            <i class="fa fa-calendar"></i>
                                        </div>
                                        <input type="text" class="form-control pull-right"
                                               name="oprateTime" id="oprateTime">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label
                                        style="width: 13.8%;margin-right: 6px; padding-right: 10px"
                                        class="col-sm-1 control-label" >附件</label>
                                <div class="col-sm-10" >
									<textarea class="form-control" name="str1" rows="3"  style="width: 93%;"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-group">
                                <label
                                        style="width: 13.8%;margin-right: 6px; padding-right: 10px"
                                        class="col-sm-1 control-label" for="remark">备注</label>
                                <div class="col-sm-10" >
									<textarea class="form-control" id="remark" name="remark" rows="3" style="width: 93%;"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group" hidden="true">
                                <label class="col-sm-4 control-label" for="add_action_type">类型</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control pull-right" value="2"
                                           hidden="true" name="actionType" id="add_action_type">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="formReset()"
                        data-dismiss="modal" style="width: 80px; margin-right: 8px;">关闭</button>
                <button class="btn btn-primary" onclick="submitForm()"
                        data-loading-text="正在提交..." style="width: 80px;">确定</button>
            </div>
        </form>
    </div>
</div>

<script>

    var datatable_lend;
    function initDatatable() {
        datatable_lend = $('#transferAccounts_table').DataTable({
            "dom": '<"toolbar">frtip',
            "searching": false,
            "processing": false,
            "serverSide": false,
            "paging": false,
            "select": false,
            "ordering": false,
            "bLengthChange" : false,
            "info" : false,
            "destroy":true,

            //"sScrollY":"200px",
            "language": {
                "url": "${base}/assets/plugins/datatables/cn.json"
            },

            "preDrawCallback": function () {
                sublime.showLoadingbar($(".main-content"));
            },
            "drawCallback": function (settings) {
                sublime.closeLoadingbar($(".main-content"));
            },

            "ajax": {
                "url": "${base}/asset/recode/showTransferAccountsInfo",
                "type": "post",
                "data": function (d) {
                    d.assetCodeArray = $('#assetCodeArray').val().trim();
                }
            },
//        "order": [[0, "desc"]],
            "columns": [
                {"data": "assetCode", "bSortable": true},
                {"data": "assetName", "bSortable": true},
                {"data": "serialNumber", "bSortable": true},
                {"data": "deviceVersion", "bSortable": true},
                {"data": "ggName", "bSortable": true},
                {"data": "remark", "bSortable": true},
                {"data": "str1", "bSortable": true}

            ],
            "columnDefs": [

                {
                    "render": function (data, type, row) {
                        if(data == null || "" == data) {return "--"}else {return data};
                    },
                    "targets": [0,1,2,3,4,5,6]
                }
            ]
        });

        /* 点击选中 */
        datatable_lend.on('click', 'tr', function () {
            $(this).toggleClass('selected');
        });
    }

    //批量赋值仪器编码
    function submitForm(){

        $('#transferAccountsForm').ajaxForm({
            dataType: 'json',
            beforeSubmit: function (arr, form, options) {

                $("input").removeAttr("disabled");
                if($("#applyDepart").val()==""){
                    Toast.error("现使用单位不能为空");
                    return false;
                }
                if($("#applyPerson").val()=="" && ($("#assetType").val()) != 1){
                    Toast.error("现使用人不能为空");
                    return false;
                }
                if($("#add_original_depart").val()==""){
                    Toast.error("办理单位不能为空");
                    return false;
                }
                if($("#add_handle_person").val()==""){
                    Toast.error("办理人不能为空");
                    return false;
                }
                if($("#transferAccountsTime").val()==""){
                    Toast.error("转账时间不能为空");
                    return false;
                }
                if($("#oprateTime").val()==""){
                    Toast.error("办理时间不能为空");
                    return false;
                }

                form.find("button:submit").button("loading");
            },
            success: function (data, statusText, xhr, form) {
                if (data.code == 0) {
                    Toast.success(data.msg);
                    //刷新父级菜单
                    datatable.ajax.reload();
                    setTimeout(function () {
                        $("#goback").trigger("click");
                    }, 500);
                } else {
                    Toast.error(data.msg);
                }
                form.find("button:submit").button("reset");
                $("#homeDetail").modal('hide');

            }
        });
    }

    //清空form以及表单
    function formReset(){
        document.getElementById("transferAccountsForm").reset();
        var table = document.getElementById("transferAccounts_table");
        table.innerHTML ="";
        $("#assetCode").val("");
    }

</script>

<script language="JavaScript">
    $(document).ready(function () {

        setTimeout(function () {
            initDatatable();
            //$("#transferAccounts_table").val("");
            $("#assetCode").focus();
        }, 200);

        loadUnitAndUserNoKuFang("applyDepart","applyPerson");
        //设置时间
        setDate("transferAccountsTime","oprateTime");
        //初始化默认时间
        $('#transferAccountsTime').val((new Date()).format("yyyy-MM-dd"));
        $('#oprateTime').val((new Date()).format("yyyy-MM-dd"));
    });

</script>