
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            
                <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">
             	  ${obj.resultPage}
                </h4>
            </div>
            
            <!-- 计量单 -->
            <%if(obj.reusltType==5){%>
             <div class="modal-body">
                <div class="box-body">
                    <div class="form-horizontal" id="defaultForm" >
                        <div class="row">
                            <!-- /.col -->
                            <div class="facility-form">
                                <div class="facility-from-col">
                                    <div class="col-md-12">
                                     <!-- <div class="form-group">
                             			<label for="measureMan" class="col-sm-2 control-label">计量人：</label>
                                  		 	<div class="col-sm-3">
                                    			<input type="text" class="form-control" id="measureMan" value="${@shiro.getPrincipalProperty('username')}" st>
                                   		 </div>       
                                     </div> -->
                                         <div class="form-group">
                                	<label for="measureResult" class="col-sm-2 control-label">计量结论：</label>
                                    <div class="col-sm-8">
                                    	<textarea class="form-control" id="measureResult"></textarea>
                                    </div>
                                    
                                </div>
           					 </div>
           				 </div>
          		  		</div>
           		 	</div>
           		</div>
           	</div>
          </div>
        <%}else{%>   
            
        <!-- 维修单 -->
            <div class="modal-body">
                <div class="box-body">
                    <div class="form-horizontal" id="defaultForm" >
                        <div class="row">
                            <!-- /.col -->
                            <div class="facility-form">
                                <div class="facility-from-col">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                    <label for="assetCode" class="col-sm-2 control-label">统一编号：</label>
                                   	<div class="col-sm-3">
                                    	<input type="text" class="form-control" id="assetCode" value="${obj.assetCode}" disabled="disabled">
                                    </div>
                                       
                                        <label for="deviceCode" class="col-sm-2 control-label">资产类型：</label>
                                       	<div class="col-sm-3">
	                                       	<select class="form-control" id="assetType" disabled="disabled">
	                                       	  <option value=""></option>
	                                       	  <%if(obj.assetType==1){ %>
	                                       	   <option value="1" selected="selected">设备</option>
	                                       	 <%}%>
	                                       	 <%if(obj.assetType==2){%>
	                                       	  <option value="2" selected="selected">仪器</option>
	                                       	  <%}%>
	                                       	</select>
                                        </div>
                                       
                                       
                                       
                                 </div>
                                <div class="form-group">
                                    <label for="assetName" class="col-sm-2 control-label">资产名称：</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" id="assetName" disabled="disabled" value="${obj.assetName}">
                                    </div>
                                    <label for="serialNumber" class="col-sm-2 control-label">出厂编号：</label>
                                    <div class="col-sm-3">
                                    	<input type="text" class="form-control" id="serialNumber" disabled="disabled" value="${obj.serialNumber}">
                                    </div>
                                    
                                    
                                </div>
                                
                                <div class="form-group">
                                	
                                    
                                    <label for="deviceVersion" class="col-sm-2 control-label">型号规格：</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" id="deviceVersion" disabled="disabled" value="${obj.deviceVersion}">
                                    </div>
                                    
                                     <label for="linkMan" class="col-sm-2 control-label">联系人：</label>
	                                    <div class="col-sm-3">
	                                        <input type="text" class="form-control" id="linkMan" value="${obj.linkman}" disabled="disabled">
	                                    </div>
                                    
                                    
                                </div>
                                
                                <div class="form-group">
	                                     <label for="linkPhone" class="col-sm-2 control-label">联系电话：</label>
	                                    <div class="col-sm-3">
	                                        <input type="text" class="form-control" id="linkPhone" value="${obj.linkphone}" disabled="disabled">
	                                    </div>
	                                    
	                                     <%if(obj.assetType==2){%>
	                                     <label for="linkPhone" class="col-sm-2 control-label">送修单位：</label>
	                                    <div class="col-sm-3">
	                                        <input type="text" class="form-control" id="sendDepart"  disabled="disabled">
	                                    </div>
	                                 </div>   
	                                     
	                                  <div class="form-group">
	                                     <label for="linkPhone" class="col-sm-2 control-label">送修人：</label>
	                                    <div class="col-sm-3">
	                                        <input type="text" class="form-control" id="sendPerson"  disabled="disabled">
	                                    </div>
	                                    
	                                    <%}%>
	                                    
                               		 <label for="repairDepart" class="col-sm-2 control-label">维修单位：</label>
	                                    <div class="col-sm-3">
	                                        <input type="text" class="form-control" id="repairDepart"   <%if(obj.reusltType!=3){%>disabled="disabled" value="${obj.remarkDepart}" <%}%> >
	                                    </div>
	                                    
                                    </div>
                                     
                                
                                
                                       <div class="form-group">
	                                     <!-- <label for="repairMan" class="col-sm-2 control-label">维修人：</label>
	                                    <div class="col-sm-3">
	                                        <input type="text" class="form-control" id="repairMan"  <%if(obj.reusltType!=3){%>disabled="disabled" value="${obj.remarkMan}" <%}%>>
	                                    </div> -->
	                                    
	                                     <label for="repairCost" class="col-sm-2 control-label">维修费用：</label>
	                                    <div class="col-sm-3">
	                                        <input type="text" class="form-control" id="repairCost"  onkeyup="clearNoNum(this)" placeholder="单位:元" <%if(obj.reusltType!=3){%>disabled="disabled" value="${obj.repairCost}" <%}%>>
	                                    </div>
                                    </div>
                                
                                 <div class="form-group">
                                 <label for="repairContent" class="col-sm-2 control-label">维修内容：</label>
	                                    <div class="col-sm-8">
	                                       <!--  <textarea class="form-control" id="repairContent" <%if(obj.reusltType!=3){%>disabled="disabled"> ${obj.repairContent} <%}else{%>><%}%></textarea> -->
	                                        	<textarea class="form-control" id="remark" <%if(obj.reusltType!=3){%>disabled="disabled" > ${obj.repairRemark} <%}else{%>><%}%></textarea>
	                                       
	                                    </div>
                                  </div>
                                
                                
                                <!--  <div class="form-group">
                                	<label for="remark" class="col-sm-2 control-label">维修结论：</label>
                                    <div class="col-sm-8">
                                    	<textarea class="form-control" id="remark" <%if(obj.reusltType!=3){%>disabled="disabled" > ${obj.repairRemark} <%}else{%>><%}%></textarea>
                                    </div>
                                    
                                </div> -->
                              
                                <%if(obj.reusltType==3&&obj.assetType==2){%>
                                <div class="form-group">
                                	<label for="remark" class="col-sm-2 control-label">是否计量：</label>
                                    <div class="col-sm-1" style="margin-top: 6px;">
                                    	<input  type="checkbox" name="measure" id="measure" checked="checked">
                                    </div>
                                    
                                </div>
                                <%}%>
                              
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
               
            </div>
            
            <%}%>
             
            
            <div class="modal-footer">
                <button class="btn btn-default" data-dismiss="modal"  type="button">关闭</button>
                <button type="button" class="btn btn-primary facilityadd-btn"  style="margin-right: 383px;" onclick="resultCommit(${obj.id});">确认</button>
            </div>
            
            <!-- 维修结果状态 -->
            <input id="reusltType" type="hidden" value="${obj.reusltType}">
            
            
        </div>
    </div>
</div>
<script>

$(function(){
	 <%if(obj.assetType==2){%>
	loadUnitAndUser("sendDepart","sendPerson");
	var sendDepart = '${obj.senddepart}';
	var sendPerson = '${obj.sendperson}';
	setValueSelect(sendPerson,sendDepart,"sendDepart","sendPerson");
	<%}%>
}) ;


function clearNoNum(obj){  
	  obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符   
	  obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的   
	  obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");  
	  obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3');//只能输入两个小数   
	  if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额  
	   obj.value= parseFloat(obj.value);  
	  }  
	}


	function resultCommit(id){
		
		var re = $("#reusltType").val();
	    var remark = $("#remark").val() ;
		var ustr="";
		var param ;
		
		if(re==3){
			ustr="doRepairing" ;
			var repairDepart =  $("#repairDepart").val() ;
			//var repairMan=$("#repairMan").val() ;
			//var repairContent = $("#repairContent").val() ;
			var repairCost = $("#repairCost").val() ;
			var measure = $('#measure').is(":checked") ;
			if(!(repairDepart&&remark&&repairCost)){
				return Toast.error("请检查各项参数是否为空");
			}
			param = {id:id,type:$("#type").val(),repairDepart:repairDepart,remark:remark,repairCost:repairCost,measure:measure};
		}else{
			ustr="doMeter" ;
			var measureMan=$("#measureMan").val() ;
			var measureResult=$("#measureResult").val() ;
			
			if(!measureResult){
				return Toast.error("请检查计量结论是否为空");
			}
			param ={id:id,repairMan:measureMan,remark:measureResult};
		}
		
		   $.ajax({
        	type:"post",
        	url:"${base}/repair/"+ustr,
        	data:param,
        	async:false,
        	success:function(data){
        		if (data.code == 0) {
                    Toast.success(data.msg);
                } else {
                    Toast.error(data.msg);
                }
                    datatable.ajax.reload();
        		  $("#myModal2").modal('hide');
        	},
        	error:function(data){
        		Toast.error("网络异常");
        	}
        });   
		
	}
	
</script>
